# Koradi Bingo - Arte que Sana

![Koradi Bingo](./client/src/assets/koradi-logo.png)

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Node](https://img.shields.io/badge/node-%3E%3D18.0.0-green.svg)
![React](https://img.shields.io/badge/react-18.2.0-blue.svg)
![Express](https://img.shields.io/badge/express-4.19.2-lightgrey.svg)

Plataforma de Bingo de donaci√≥n dise√±ada para recaudar fondos para el programa de rehabilitaci√≥n de la Fundaci√≥n Koradi.

Esta aplicaci√≥n web interactiva combina la emoci√≥n del bingo con el impacto social, con el objetivo de recaudar COP $21.100.000 - $24.100.000 para mejorar las condiciones de vida de 25 j√≥venes en rehabilitaci√≥n.

Es una plataforma full-stack que combina tecnolog√≠as como React para el frontend, Node.js y Express para el backend, y MongoDB para la base de datos.

## Tabla de Contenidos

- [Descripci√≥n](#descripci√≥n)
- [Caracter√≠sticas](#caracter√≠sticas)
- [Tecnolog√≠as](#tecnolog√≠as)
- [Primeros Pasos](#primeros-pasos)
  - [Prerrequisitos](#prerrequisitos)
  - [Instalaci√≥n](#instalaci√≥n)
- [Uso](#uso)
  - [Modo de Desarrollo](#modo-de-desarrollo)
  - [Modo de Producci√≥n](#modo-de-producci√≥n)
  - [Comandos Make Disponibles](#comandos-make-disponibles)
- [Endpoints de la API](#endpoints-de-la-api)
- [Configuraci√≥n de Bold](#configuraci√≥n-de-bold)
- [Configuraci√≥n de Webhook de Stripe](#configuraci√≥n-de-webhook-de-stripe)
- [Configuraci√≥n de servidor seguro](#configuraci√≥n-de-servidor-seguro)
- [Estructura del Proyecto](#estructura-del-proyecto)
- [Licencia](#licencia)
- [Contribuir](#contribuir)
- [Cr√©ditos](#cr√©ditos)

## Descripci√≥n

Koradi Bingo es una plataforma de bingo moderna y en tiempo real que permite a los participantes comprar cartones de bingo o hacer donaciones directas para apoyar a j√≥venes en rehabilitaci√≥n. La plataforma cuenta con sorteo de n√∫meros en vivo, verificaci√≥n autom√°tica de ganadores, seguimiento de progreso en tiempo real y procesamiento seguro de pagos a trav√©s de Stripe.

El proyecto encarna la misi√≥n "Arte que Sana" combinando tecnolog√≠a con impacto social, creando una forma atractiva para que la comunidad contribuya a una causa significativa.

## Caracter√≠sticas

- üéØ **Juego de Bingo en Tiempo Real**: Sorteo de n√∫meros en vivo con Socket.IO para actualizaciones instant√°neas
- üí≥ **Pagos Seguros**: Integraci√≥n con Stripe para cartones de bingo (COP $30.000) y donaciones libres
- üèÜ **Detecci√≥n Autom√°tica de Ganadores**: Algoritmo inteligente que valida las victorias de bingo (horizontal, vertical, diagonal)
- üìä **Seguimiento de Progreso en Vivo**: Progreso de donaciones en tiempo real hacia la meta de recaudaci√≥n
- üì± **Dise√±o Responsivo**: Interfaz amigable para m√≥viles con la identidad visual de Koradi
- üîê **Panel de Administraci√≥n**: Herramientas para el personal para gestionar sorteos y monitorear reclamos
- üé´ **Cartones de Bingo √önicos**: Cartones generados algor√≠tmicamente siguiendo las reglas est√°ndar B-I-N-G-O
- üåê **Soporte Multi-idioma**: Dise√±ado para audiencia de habla hispana
- ‚ö° **Notificaciones en Tiempo Real**: Actualizaciones instant√°neas para sorteos de n√∫meros y reclamos de bingo

## Tecnolog√≠as

### Backend
- **Node.js** (‚â•18.0.0) - Entorno de ejecuci√≥n
- **Express.js** (4.19.2) - Framework web
- **MongoDB** con Mongoose (8.3.1) - Base de datos y ODM
- **Socket.IO** (4.7.5) - Comunicaci√≥n en tiempo real
- **Stripe** (14.0.0) - Procesamiento de pagos
- **CORS** (2.8.5) - Intercambio de recursos de origen cruzado

### Frontend
- **React** (18.2.0) - Framework de UI
- **Vite** (5.3.3) - Herramienta de construcci√≥n y servidor de desarrollo
- **Socket.IO Client** (4.7.5) - Cliente en tiempo real

### Herramientas de Desarrollo
- **Nodemon** (3.0.3) - Reinicio autom√°tico del servidor de desarrollo
- **Morgan** (1.10.0) - Logger de peticiones HTTP
- **Concurrently** (8.2.2) - Ejecutar m√∫ltiples comandos
- **Make** - Automatizaci√≥n de construcci√≥n

## Primeros Pasos

### Prerrequisitos

Antes de ejecutar este proyecto, aseg√∫rate de tener instalado lo siguiente:

- **Docker** (para despliegue en contenedores)
- **Node.js** (versi√≥n 18.0.0 o superior)
- **MongoDB** (instalaci√≥n local o mejor aun MongoDB Atlas)
- **Cuenta de Bold** (para procesamiento de pagos desde Colombia)
- **Cuenta de Stripe** (para procesamiento de pagos desde Estados Unidos)
- **Git** (para clonar el repositorio)
- **Make** (para automatizaci√≥n de construcci√≥n)

### Instalaci√≥n

1. **Clonar el repositorio**
```bash
git clone https://github.com/otobonh/koradi-bingo.git
cd koradi-bingo
```

2. **Instalar todas las dependencias (server y client)**
```bash
npm install
```

3. **Configurar variables de entorno**

Crear archivos `.env` en los directorios ra√≠z y servidor:

**`.env` en directorio client:**
```bash
VITE_APP_DOMAIN_NAME=localhost
VITE_API_BASE_URL=http://${VITE_APP_DOMAIN_NAME}:4000
VITE_STRIPE_PUBLIC_KEY=pk_test_your_stripe_public_key_here
VITE_BOLD_PUBLIC_KEY=pk_test_your_bold_public_key_here
VITE_BINGO_PRICE=${BINGO_PRICE:-30000}
VITE_DEBUG=0
```

**`.env` en directorio server:**
```bash
SERVER_DEBUG=1
PORT=4000
APP_DOMAIN_NAME=localhost
MONGO_DATABASE=koradi_bingo
MONGO_USERNAME=root
MONGO_PASSWORD=example
MONGO_URI=mongodb://${MONGO_USERNAME}:${MONGO_PASSWORD}@mongo:27017
CORS_ORIGIN=http://${APP_DOMAIN_NAME}
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here
BOLD_PRIVATE_KEY=pk_test_your_bold_private_key_here
APP_NAME="Koradi Bingo"
ORG_NAME="Fundaci√≥n Koradi"
GOAL_MIN=21100000
GOAL_MAX=24100000
BINGO_PRICE=30000
ADMIN_USERNAME=username
ADMIN_PASSWORD=password
```

4. **Iniciar MongoDB**

Aseg√∫rate de que MongoDB est√© ejecut√°ndose en tu sistema o configura la conexi√≥n a MongoDB Atlas.

## Uso

### Modo de Desarrollo

* Con Docker y MongoDb local

**Iniciar cliente, servidor y mongoDB simult√°neamente:**
```bash
make run
```

**Reinicio de servicios:**
```bash
make restart
```

**Detener servicios:**
```bash
make down
```

* Con Vite, NodeJS y MongoDb Atlas

**Iniciar cliente y servidor simult√°neamente:**
```bash
npm run dev
```

**O iniciarlos por separado:**

**Iniciar el servidor:**
```bash
cd server
make dev
```

**Iniciar el cliente (en otra terminal):**
```bash
cd client
make dev
```

### Modo de Producci√≥n

**Construir el cliente:**
```bash
cd client
make build
```

**Iniciar el servidor:**
```bash
cd server
make start
```

**Entrar en el sistema**

- Cargar el navegador web de su preferencia
- Ir a [http://localhost](http://localhost)

### Comandos Make Disponibles

**Comandos del directorio ra√≠z:**
```bash
make run                # Ejecutar en modo desarrollo
make up                 # Ejecutar en modo producci√≥n
make down               # Detener servicios
make restart            # Reiniciar servicios (con docker-compose restart)
make hard-restart       # Reiniciar servicios desde cero
make logs               # Mostrar logs
make logs-f             # Seguir logs
make clean-docker       # Limpiar docker
make status             # Mostrar estado de los servicios en Docker
make install            # Instalar dependencias de todos los proyectos (server y client)
make build              # Construir el cliente
make start              # Iniciar el servidor
make dev                # Iniciar el cliente
make clean              # Limpiar dependencias de todos los proyectos (server y client)
make list-scripts       # Listar scripts disponibles
make ssl-certs-creation # Crear certificados SSL
```

**Comandos del servidor:**
```bash
cd server
make install     # Instalar dependencias
make run         # Ejecutar en modo desarrollo
make dev         # Alias de run
make start       # Ejecutar en modo producci√≥n
make clean       # Limpiar node_modules y package-lock.json
make reinstall   # Limpiar y reinstalar dependencias
make help        # Mostrar comandos disponibles
```

**Comandos del cliente:**
```bash
cd client
make install       # Instalar dependencias
make build         # Construir para producci√≥n
make run           # Ejecutar en modo desarrollo
make dev           # Alias de run
make preview       # Vista previa de construcci√≥n de producci√≥n
make clean         # Limpiar node_modules, package-lock.json y dist
make reinstall     # Limpiar y reinstalar dependencias
make build-preview # Construir y previsualizar versi√≥n de producci√≥n
make help          # Mostrar comandos disponibles
```

### Endpoints de la API

- `GET /api/health` - Verificaci√≥n de salud
- `GET /api/progress` - Obtener progreso de donaciones
- `POST /api/checkout` - Crear sesi√≥n de checkout de Stripe
- `GET /api/my-card` - Obtener cart√≥n de bingo del usuario
- `POST /api/claim-bingo` - Reclamar victoria de bingo
- `GET /api/draw/state` - Obtener estado actual del sorteo
- `GET /api/live-url` - Obtener URL de transmisi√≥n
- `POST /api/bold-hash` - Generar hash de Bold
- `POST /api/admin/draw/next` - Sortear siguiente n√∫mero (admin)
- `POST /api/admin/draw/reset` - Reiniciar sorteo (admin)
- `POST /api/admin/login` - Iniciar sesi√≥n (admin)
- `POST /api/admin/set-live-url` - Establecer URL de transmisi√≥n (admin)

### Configuraci√≥n de Bold

Configura tu cuenta de Bold en [bold.co](https://bold.co).

Luego extrae las credenciales de tu cuenta de Bold y agr√©galas a los archivos `.env` del servidor y del cliente.

En el archivo `client/.env` del cliente:
```env
# Llave publica de Bold
VITE_BOLD_PUBLIC_KEY=pk_test_tu_clave_publica_bold
```

En el archivo `server/.env` del servidor:
```env
# Llave privada de Bold
BOLD_PRIVATE_KEY=pk_test_your_bold_private_key_here
```

### Configuraci√≥n de Webhook de Stripe

Configura tu cuenta de Stripe en [stripe.com](https://stripe.com).

Luego extrae las credenciales de tu cuenta de Stripe y agr√©galas a los archivos `.env` del servidor y del cliente.

En el archivo `client/.env` del cliente:
```env
# Llave publica de Stripe
VITE_STRIPE_PUBLIC_KEY=pk_test_your_stripe_public_key_here
```

En el archivo `server/.env` del servidor:
```env
# Llave privada de Stripe
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key_here
# Llave de webhook de Stripe
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here
```

Configura tu endpoint de webhook de Stripe para que apunte a:

```
https://tudominio.com/api/stripe/webhook
```

Eventos a escuchar:
- `checkout.session.completed`

### Configuraci√≥n de servidor seguro

Configura tu servidor local para que use SSL, de tal forma de poder probar las funcionalidades de pago, ya que algunas APIs de pago y funcionailidades de Javascript (por ejemplo `crypto`) requieren que el servidor sea seguro.

Para ello, puedes usar el script `make ssl-certs-creation` que crear√° los certificados SSL en el directorio `server/ssl`.

Crear una entrada en el archivo `/etc/hosts` con el siguiente contenido:

```bash
sudo nano /etc/hosts
```

Agregar la siguiente l√≠nea:

```
127.0.0.1 koradibingo.dev
```

Luego se debe configurar las siguientes variables en los archivos `.env` del servidor y del cliente:

En el archivo `client/.env` del cliente:
```env
VITE_APP_DOMAIN_NAME=koradibingo.dev
VITE_API_BASE_URL=https://${VITE_APP_DOMAIN_NAME}
```

En el archivo `server/.env` del servidor:
```env
APP_DOMAIN_NAME=koradibingo.dev
CORS_ORIGIN=https://${APP_DOMAIN_NAME}
```

## Estructura del Proyecto

```
koradi-bingo/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ package.json              # Gestor de workspace (npm workspaces)
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ server/                   # Backend (Express + MongoDB + Socket.IO)
‚îÇ   ‚îú‚îÄ‚îÄ Makefile
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ webhookTest.http
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ server.js         # Archivo principal del servidor
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ db.js         # Conexi√≥n a MongoDB
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ env.js        # Configuraci√≥n de entorno
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ User.js       # Esquema de usuario
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ BingoCard.js  # Esquema de cart√≥n de bingo
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Donation.js   # Esquema de donaci√≥n
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ DrawState.js  # Esquema de estado del sorteo
‚îÇ       ‚îú‚îÄ‚îÄ services/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ bingo.js      # L√≥gica de bingo y generaci√≥n de cartones
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ payments.js   # Procesamiento de pagos con Stripe
‚îÇ       ‚îú‚îÄ‚îÄ routes/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ public.js     # Rutas p√∫blicas de la API
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ admin.js      # Rutas de administraci√≥n de la API
‚îÇ       ‚îî‚îÄ‚îÄ utils/
‚îÇ           ‚îî‚îÄ‚îÄ logger.js     # Utilidad de logging
‚îú‚îÄ‚îÄ client/                   # Frontend (React + Vite)
‚îÇ   ‚îú‚îÄ‚îÄ Makefile
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ main.jsx          # Punto de entrada de React
‚îÇ       ‚îú‚îÄ‚îÄ App.jsx           # Componente principal de la App
‚îÇ       ‚îú‚îÄ‚îÄ api.js            # Cliente de API
‚îÇ       ‚îú‚îÄ‚îÄ styles.css        # Estilos globales
‚îÇ       ‚îú‚îÄ‚îÄ components/       # Componentes de React
‚îÇ       ‚îî‚îÄ‚îÄ assets/           # Recursos est√°ticos
‚îî‚îÄ‚îÄ deploy/                   # Configuraci√≥n de despliegue
    ‚îú‚îÄ‚îÄ docker-compose.yml
    ‚îî‚îÄ‚îÄ nginx.conf
```

## Licencia

Este proyecto est√° licenciado bajo la Licencia MIT - consulta el archivo [LICENSE](LICENSE) para m√°s detalles.

## Contribuir

1. Haz fork del repositorio
2. Crea tu rama de caracter√≠stica (`git checkout -b feature/CaracteristicaIncreible`)
3. Confirma tus cambios (`git commit -m 'Agregar alguna CaracteristicaIncreible'`)
4. Empuja a la rama (`git push origin feature/CaracteristicaIncreible`)
5. Abre un Pull Request

Por favor, aseg√∫rate de actualizar las pruebas seg√∫n corresponda y seguir el estilo de c√≥digo existente.

## Cr√©ditos

Este proyecto es desarrollado y mantenido por [Omar Tobon](https://omartobon.com). Para m√°s informaci√≥n o para contribuir al proyecto, visita [Koradi Bingo](https://github.com/otobonh/koradi-bingo).

---

**Fundaci√≥n Koradi - Arte que Sana** üé®‚ú®  
*Apoyando a j√≥venes en rehabilitaci√≥n a trav√©s del poder sanador del arte y la comunidad.*